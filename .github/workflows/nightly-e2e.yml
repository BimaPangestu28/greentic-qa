name: Nightly E2E

on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch:

defaults:
  run:
    shell: bash

env:
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: 1

jobs:
  nightly:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: 1.90.0

      - name: Build workspace
        run: cargo build --workspace

      - name: Run headless QA wizard smoke
        run: |
          chmod +x ci/scripts/smoke.sh
          SMOKE_OUTPUT_DIR=nightly-output ./ci/scripts/smoke.sh

      - name: Upload nightly artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: nightly-output
          path: nightly-output
